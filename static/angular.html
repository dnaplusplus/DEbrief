<!DOCTYPE html>
<html>
<link rel="stylesheet" href="style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="bio-pv.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<body>

<div data-ng-app="pdbViewerApp" data-ng-controller="pdbViewerCtrl" data-ng-init="pdb={id:'2AAV',residues:[1,5]}">
 	<p>PDB id: <input type="text" data-ng-model="pdb.id"></p>
 	<pdb-viewer></pdb-viewer>
</div>


<script>
var app = angular.module("pdbViewerApp", []);

app.controller("pdbViewerCtrl", function($scope, $timeout) {
	$scope.$watch('pdb.id', function (val) {
		$timeout(function() {
			$.ajax('http://files.rcsb.org/download/' + val + '.pdb')
			.done(function(data) {
				geom = viewer.cartoon('protein', data, {color: color.bySS()});
				selectedAtoms = [];
				viewer.autoZoom();
			})
			.fail(function() {
				// Take no action.
			});
        },0)
	});
});

app.directive("pdbViewer", function($timeout) {
    return {
        template: '<div id="structure-viewer"></div>',
        link: function(scope, element) {
        	$timeout(function() {
        		// Initialise structure viewer:
            	var options = {
            		width: 'auto',
            		height: 'auto',
            		antialias: true,
            		quality: 'medium'
            	};
            	
            	viewer = pv.Viewer(document.getElementById("structure-viewer"), options);
            	viewer.fitParent();
            	
            	window.onresize = function(event)
    			{
    				viewer.fitParent();
    			}
            },0)
        }
    };
});
</script>
</body>
</html>